<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Jekyll Gallery Hosting pt7: automated sync and deploy with git-annex | DavidS’ log</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Jekyll Gallery Hosting pt7: automated sync and deploy with git-annex" />
<meta name="author" content="David Schmitt" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="After last week’s reintroduction to the plugin, today was focused on getting the data to and from the server." />
<meta property="og:description" content="After last week’s reintroduction to the plugin, today was focused on getting the data to and from the server." />
<link rel="canonical" href="https://club.black.co.at/log/posts/2020-09-07-git-annex-sync-deploy/" />
<meta property="og:url" content="https://club.black.co.at/log/posts/2020-09-07-git-annex-sync-deploy/" />
<meta property="og:site_name" content="DavidS’ log" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-07T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Jekyll Gallery Hosting pt7: automated sync and deploy with git-annex" />
<meta name="twitter:site" content="@dev_el_ops" />
<meta name="twitter:creator" content="@dev_el_ops" />
<script type="application/ld+json">
{"description":"After last week’s reintroduction to the plugin, today was focused on getting the data to and from the server.","@type":"BlogPosting","url":"https://club.black.co.at/log/posts/2020-09-07-git-annex-sync-deploy/","headline":"Jekyll Gallery Hosting pt7: automated sync and deploy with git-annex","datePublished":"2020-09-07T00:00:00+00:00","dateModified":"2020-09-07T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://club.black.co.at/log/posts/2020-09-07-git-annex-sync-deploy/"},"author":{"@type":"Person","name":"David Schmitt"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/log/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://club.black.co.at/log/feed.xml" title="DavidS' log" /><script async defer data-domain="club.black.co.at" src="https://plausible.black.co.at/js/plausible.js"></script>
    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-155086367-1', 'auto');
	ga('send', 'pageview', { 'page': location.pathname + location.search + location.hash});
	ga('set', 'anonymizeIp', true);
    </script>
    <!-- End Google Analytics -->
    </head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/log/">DavidS&#39; log</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/log/cv/index.html">DavidS&#39; CV</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Jekyll Gallery Hosting pt7: automated sync and deploy with git-annex</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-09-07T00:00:00+00:00" itemprop="datePublished">Sep 7, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>After last week’s <a href="/log/posts/2020-09-01-revisiting-cheesy-gallery/index.html">reintroduction</a> to the plugin,
today was focused on getting the data to and from the server.</p>

<p>In the morning session a complete re-init of the cheesy.at repo lead to great success using the git-annex webapp assistant to sync data to the repo on the server and update the checkout there.</p>

<p>In the afternoon session I worked on two major points: <a href="https://github.com/jekyll/jekyll/pull/8376">fixing the symlink handling of jekyll</a>
and getting the docker container for deployment up to scratch to the point where I can now build the site.</p>

<p>The latter required a few additional build dependencies so the native extensions can build.
Now the site builds correctly on the hosting server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@33bb570ae200:/srv/cheesy.at/git# JEKYLL_ENV=production bundle exec jekyll build --strict --trace --incremental --destination ../site
Configuration file: /srv/cheesy.at/git/_config.yml
            Source: /srv/cheesy.at/git
       Destination: /srv/cheesy.at/site
 Incremental build: enabled
      Generating...
/var/lib/gems/2.7.0/gems/sorbet-runtime-0.5.5891/lib/types/private/methods/call_validation.rb:126: warning: Passing the keyword argument as the last hash parameter is deprecated
/var/lib/gems/2.7.0/gems/cheesy-gallery-0.5.0/lib/cheesy-gallery/gallery_index.rb:11: warning: The called method `read_content' is defined here
       Jekyll Feed: Generating feed for posts
     Build Warning: Layout 'nav_menu_item' requested in _posts/2014-04-25-21024.html does not exist.
     Build Warning: Layout 'nav_menu_item' requested in _posts/2014-04-25-21025.html does not exist.
     Build Warning: Layout 'nav_menu_item' requested in _posts/2014-04-25-21026.html does not exist.
     Build Warning: Layout 'nav_menu_item' requested in _posts/2014-04-25-21027.html does not exist.
     Build Warning: Layout 'nav_menu_item' requested in _posts/2014-04-25-home.html does not exist.
     Build Warning: Layout 'ecwd_event' requested in _posts/2015-11-05-rock-in-vienna.html does not exist.
     Build Warning: Layout 'ecwd_calendar' requested in _posts/2015-11-05-cd.html does not exist.
     Build Warning: Layout 'ecwd_event' requested in _posts/2015-11-05-u2.html does not exist.
     Build Warning: Layout 'ecwd_event' requested in _posts/2015-11-05-the-prodigy.html does not exist.
     Build Warning: Layout 'ecwd_event' requested in _posts/2015-11-05-bryan-adams.html does not exist.
          Conflict: The URL '/srv/cheesy.at/site/about/index.html' is the destination for the following pages: about.md, about/index.html
                    done in 13.425 seconds.
 Auto-regeneration: disabled. Use --watch to enable.
root@33bb570ae200:/srv/cheesy.at/git# rm -Rf _site/
root@33bb570ae200:/srv/cheesy.at/git# ls ../site/
2006  2009  2012  2015	2018	  about      feed.xml	 index.html
2007  2010  2013  2016	2019	  assets     fotos
2008  2011  2014  2017	404.html  export.rb  gaestebuch
root@33bb570ae200:/srv/cheesy.at/git#
</code></pre></div></div>

<p>Clearly there is still a lot to do.
This still needs to be automated on push,
and the generated site is not actually available online.
Configuring a test host will likely be my next step as this will allow me to show off the work already done.
(I also expect it to be pretty easy and give me a nice success boost.)
The automation of build will happen in a <code class="language-plaintext highlighter-rouge">post-receive</code> hook,
which will need to be careful about which pushes trigger it (git-annex is a bit chatty there),
whether all annexed content is already available,
and to maintain correct permissions when content is being pushed by different users.
Currently half of the site is owned by root, which is not great.</p>

  </div><a class="u-url" href="/log/posts/2020-09-07-git-annex-sync-deploy/index.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/log/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">DavidS&#39; log</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">David Schmitt</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
